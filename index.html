<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Randomatched - PWA приложение для рандомизации команд в настольных играх">
    <meta name="theme-color" content="#6750a4">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Randomatched">
    <meta name="msapplication-TileColor" content="#6750a4">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-512.png">
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="/style.css">
    
    <!-- Inline script для предотвращения моргания темы -->
    <script>
        (function() {
            // Немедленно применяем сохраненную тему
            const savedTheme = localStorage.getItem('randomatched-theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            } else {
                // Если тема не сохранена, используем системную
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
            }
        })();
    </script>
    
    <title>Randomatched - Генератор команд</title>
</head>
<body class="bg-surface text-on-surface">
    <!-- Skip link for keyboard navigation -->
    <a href="#main-content" class="skip-link">Перейти к основному содержимому</a>
    
    <!-- Header с фиксированной позицией -->
    <header class="header-fixed" role="banner">
        <div class="header-content">
            <!-- Левая часть: кнопка смены темы -->
            <div class="header-left">
                <button 
                    id="theme-toggle"
                    class="theme-toggle-btn"
                    type="button"
                    aria-label="Переключить тему"
                    title="Переключить между светлой и темной темой"
                >
                    <span class="material-icons theme-icon" aria-hidden="true">dark_mode</span>
                </button>
            </div>
            
            <!-- Центральная часть: заголовок -->
            <div class="header-center">
                <h1 class="header-title">Randomatched</h1>
            </div>
            
            <!-- Правая часть: индикатор обновления -->
            <div class="header-right">
                <div 
                    class="update-indicator" 
                    id="update-indicator" 
                    style="display: none;"
                    role="status"
                    aria-live="polite"
                    aria-label="Статус обновления приложения"
                >
                    <span class="material-icons update-spinner" id="update-spinner" aria-hidden="true">refresh</span>
                    <span class="material-icons update-success" id="update-success" style="display: none;" aria-hidden="true">check_circle</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main контейнер с отступом сверху для header -->
    <main id="main-content" class="main-content" role="main">
        <div class="content-container">
            <!-- Секция выбора списка героев -->
            <section class="hero-selection" aria-labelledby="hero-selection-title">
                <h2 id="hero-selection-title" class="sr-only">Выбор списка героев</h2>
                <div class="dropdown-container">
                    <label for="hero-list-select" class="sr-only">Выберите список героев для генерации команд</label>
                    <select 
                        id="hero-list-select" 
                        class="hero-dropdown"
                        aria-describedby="hero-selection-help"
                        required
                    >
                        <option value="">Выберите список героев</option>
                        <option value="default">Стандартный список</option>
                        <option value="custom">Пользовательский список</option>
                    </select>
                    <div id="hero-selection-help" class="sr-only">
                        Выберите список героев, из которого будут формироваться команды
                    </div>
                    
                    <!-- Кнопка настроек справа от dropdown -->
                    <button 
                        id="settings-btn"
                        class="settings-btn"
                        type="button"
                        aria-label="Открыть настройки приложения"
                        title="Настройки"
                    >
                        <span class="material-icons" aria-hidden="true">settings</span>
                    </button>
                </div>
            </section>

            <!-- Секция основных действий -->
            <section class="action-buttons" aria-labelledby="action-buttons-title">
                <h2 id="action-buttons-title" class="sr-only">Основные действия</h2>
                
                <!-- Primary кнопка "Сгенерировать команды" -->
                <button 
                    id="generate-btn" 
                    class="btn btn-primary btn-large"
                    type="button"
                    aria-describedby="generate-help"
                >
                    <span class="material-icons" aria-hidden="true">shuffle</span>
                    <span>Сгенерировать команды</span>
                </button>
                <div id="generate-help" class="sr-only">
                    Создать случайные команды из выбранного списка героев
                </div>

                <!-- Secondary кнопки в одной строке -->
                <div class="secondary-buttons" role="group" aria-label="Дополнительные действия">
                    <!-- Secondary кнопка "Последняя генерация" -->
                    <button 
                        id="last-generation-btn" 
                        class="btn btn-secondary"
                        type="button"
                        disabled
                        aria-describedby="last-generation-help"
                    >
                        <span class="material-icons" aria-hidden="true">history</span>
                        <span>Последняя генерация</span>
                    </button>
                    <div id="last-generation-help" class="sr-only">
                        Просмотреть результат последней генерации команд
                    </div>

                    <!-- Tertiary кнопка "Сброс сессии" -->
                    <button 
                        id="reset-session-btn" 
                        class="btn btn-outline"
                        type="button"
                        aria-describedby="reset-help"
                    >
                        <span class="material-icons" aria-hidden="true">refresh</span>
                        <span>Сброс сессии</span>
                    </button>
                    <div id="reset-help" class="sr-only">
                        Очистить текущую сессию и сбросить все данные
                    </div>
                </div>
            </section>

            <!-- Секция результатов генерации -->
            <section class="generation-results" id="generation-results" aria-labelledby="results-title" style="display: none;">
                <h2 id="results-title" class="sr-only">Результаты генерации команд</h2>
                <div class="results-container" id="results-container">
                    <!-- Результаты будут добавлены динамически -->
                </div>
            </section>

        </div>
    </main>

    <!-- Скрытые элементы для скрин-ридеров -->
    <div class="sr-only" aria-live="polite" id="announcements"></div>

    <!-- Подключение основного скрипта -->
    <script type="module" src="/js/app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                console.log('[INIT] Начинаем регистрацию Service Worker...');
                
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('[INIT] Service Worker успешно зарегистрирован:', registration);
                        console.log('[INIT] Область действия SW:', registration.scope);
                        console.log('[INIT] Состояние SW:', registration.active ? registration.active.state : 'не активен');
                        
                        // Проверяем наличие обновлений при загрузке
                        if (registration.waiting) {
                            console.log('[INIT] Обнаружен ожидающий Service Worker');
                        }
                        
                        if (registration.installing) {
                            console.log('[INIT] Service Worker в процессе установки');
                        }
                    })
                    .catch((registrationError) => {
                        console.error('[INIT] Ошибка регистрации Service Worker:', registrationError);
                    });
            });
        } else {
            console.warn('[INIT] Service Worker не поддерживается в данном браузере');
        }
    </script>
</body>
</html>
