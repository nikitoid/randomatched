<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Randomatched - PWA приложение для рандомизации">
    <meta name="theme-color" content="#6750a4">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Randomatched">
    <meta name="msapplication-TileColor" content="#6750a4">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-512.png">
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="/style.css">
    
    <!-- Inline script для предотвращения моргания темы -->
    <script>
        (function() {
            // Немедленно применяем сохраненную тему
            const savedTheme = localStorage.getItem('randomatched-theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            } else {
                // Если тема не сохранена, используем системную
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
            }
        })();
    </script>
    
    <title>Randomatched</title>
</head>
<body class="bg-surface text-on-surface">
    <!-- Header с фиксированной позицией -->
    <header class="header-fixed">
        <div class="header-content">
            <!-- Левая часть: кнопка смены темы -->
            <div class="header-left">
                <button 
                    id="theme-toggle"
                    class="theme-toggle-btn"
                    aria-label="Переключить тему"
                >
                    <span class="material-icons theme-icon">dark_mode</span>
                </button>
            </div>
            
            <!-- Центральная часть: заголовок -->
            <div class="header-center">
                <h1 class="header-title">Randomatched</h1>
            </div>
            
            <!-- Правая часть: индикатор обновления -->
            <div class="header-right">
                <div class="update-indicator" id="update-indicator" style="display: none;">
                    <span class="material-icons update-spinner" id="update-spinner">refresh</span>
                    <span class="material-icons update-success" id="update-success" style="display: none;">check_circle</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main контейнер с отступом сверху для header -->
    <main class="main-content">
        <div class="content-container">
            <!-- Dropdown для выбора списка героев -->
            <div class="hero-selection">
                <div class="dropdown-container">
                    <select id="hero-list-select" class="hero-dropdown">
                        <option value="">Выберите список героев</option>
                        <option value="default">Стандартный список</option>
                        <option value="custom">Пользовательский список</option>
                    </select>
                    
                    <!-- Кнопка настроек справа от dropdown -->
                    <button 
                        id="settings-btn"
                        class="settings-btn"
                        aria-label="Настройки"
                    >
                        <span class="material-icons">settings</span>
                    </button>
                </div>
            </div>

            <!-- Основные кнопки действий -->
            <div class="action-buttons">
                <!-- Primary кнопка "Сгенерировать команды" -->
                <button id="generate-btn" class="btn btn-primary btn-large">
                    <span class="material-icons">shuffle</span>
                    <span>Сгенерировать команды</span>
                </button>

                <!-- Secondary кнопки в одной строке -->
                <div class="secondary-buttons">
                    <!-- Secondary кнопка "Последняя генерация" -->
                    <button id="last-generation-btn" class="btn btn-secondary">
                        <span class="material-icons">history</span>
                        <span>Последняя генерация</span>
                    </button>

                    <!-- Tertiary кнопка "Сброс сессии" -->
                    <button id="reset-session-btn" class="btn btn-outline">
                        <span class="material-icons">refresh</span>
                        <span>Сброс сессии</span>
                    </button>
                </div>
            </div>

            <!-- Демонстрационные кнопки для модальных окон -->
            <div class="demo-buttons">
                <h3>Демонстрация модальных окон</h3>
                <div class="demo-buttons-grid">
                    <button id="demo-fullscreen-btn" class="btn btn-outline">
                        <span class="material-icons">fullscreen</span>
                        <span>Fullscreen Modal</span>
                    </button>
                    <button id="demo-bottomsheet-btn" class="btn btn-outline">
                        <span class="material-icons">keyboard_arrow_up</span>
                        <span>Bottom Sheet</span>
                    </button>
                    <button id="demo-confirmation-btn" class="btn btn-outline">
                        <span class="material-icons">help_outline</span>
                        <span>Confirmation Dialog</span>
                    </button>
                </div>
            </div>

            <!-- Демонстрационные кнопки для toast уведомлений -->
            <div class="demo-buttons">
                <h3>Демонстрация toast уведомлений</h3>
                <div class="demo-buttons-grid">
                    <button id="demo-toast-success-btn" class="btn btn-outline">
                        <span class="material-icons">check_circle</span>
                        <span>Success Toast</span>
                    </button>
                    <button id="demo-toast-error-btn" class="btn btn-outline">
                        <span class="material-icons">error</span>
                        <span>Error Toast</span>
                    </button>
                    <button id="demo-toast-warning-btn" class="btn btn-outline">
                        <span class="material-icons">warning</span>
                        <span>Warning Toast</span>
                    </button>
                    <button id="demo-toast-info-btn" class="btn btn-outline">
                        <span class="material-icons">info</span>
                        <span>Info Toast</span>
                    </button>
                    <button id="demo-toast-multiple-btn" class="btn btn-outline">
                        <span class="material-icons">notifications</span>
                        <span>Multiple Toasts</span>
                    </button>
                    <button id="demo-toast-clear-btn" class="btn btn-outline">
                        <span class="material-icons">clear_all</span>
                        <span>Clear All</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Подключение основного скрипта -->
    <script type="module" src="/js/app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                console.log('[INIT] Начинаем регистрацию Service Worker...');
                
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('[INIT] Service Worker успешно зарегистрирован:', registration);
                        console.log('[INIT] Область действия SW:', registration.scope);
                        console.log('[INIT] Состояние SW:', registration.active ? registration.active.state : 'не активен');
                        
                        // Проверяем наличие обновлений при загрузке
                        if (registration.waiting) {
                            console.log('[INIT] Обнаружен ожидающий Service Worker');
                        }
                        
                        if (registration.installing) {
                            console.log('[INIT] Service Worker в процессе установки');
                        }
                    })
                    .catch((registrationError) => {
                        console.error('[INIT] Ошибка регистрации Service Worker:', registrationError);
                    });
            });
        } else {
            console.warn('[INIT] Service Worker не поддерживается в данном браузере');
        }
    </script>
</body>
</html>
