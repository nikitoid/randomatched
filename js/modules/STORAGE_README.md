# StorageManager - Модуль управления данными

## Описание

`StorageManager` - это модуль для работы с localStorage, который управляет всеми данными приложения Randomatched. Он обеспечивает структурированное хранение списков героев, активных списков, генераций команд и настроек.

## Структура данных

### Основная структура
```javascript
{
  "lists": {
    "local_[uuid]": {
      id: "local_[uuid]",
      name: "Название",
      heroes: ["Герой1", "Герой2"],
      type: "local",
      createdAt: timestamp
    },
    "cloud_[uuid]": {
      id: "cloud_[uuid]",
      name: "Название",
      heroes: ["Герой1", "Герой2"],
      type: "cloud",
      cached: true,
      lastSync: timestamp
    },
    "temp_[uuid]": {
      id: "temp_[uuid]",
      name: "Основной (искл)",
      heroes: ["Герой1", "Герой2"],
      type: "temp",
      baseListId: "local_[uuid]"
    }
  },
  "activeList": "local_[uuid]",
  "lastGeneration": {
    timestamp: Date.now(),
    players: [
      {number: 3, hero: "Герой1", team: 2},
      {number: 1, hero: "Герой2", team: 2},
      {number: 2, hero: "Герой3", team: 1},
      {number: 4, hero: "Герой4", team: 1}
    ]
  },
  "theme": "light",
  "settings": {}
}
```

## Основные методы

### Управление списками

#### `getLists(type)`
Получить списки по типу
- **Параметры:** `type` (string) - тип списка ('local', 'cloud', 'temp' или null для всех)
- **Возвращает:** Object - объект со списками

#### `getList(id)`
Получить конкретный список по ID
- **Параметры:** `id` (string) - ID списка
- **Возвращает:** Object|null - объект списка или null

#### `saveList(list)`
Сохранить список
- **Параметры:** `list` (Object) - объект списка
- **Возвращает:** boolean - успешность операции

#### `deleteList(id)`
Удалить список
- **Параметры:** `id` (string) - ID списка
- **Возвращает:** boolean - успешность операции

### Управление активным списком

#### `getActiveList()`
Получить активный список
- **Возвращает:** Object|null - активный список или null

#### `setActiveList(id)`
Установить активный список
- **Параметры:** `id` (string) - ID списка
- **Возвращает:** boolean - успешность операции

### Управление генерациями

#### `getLastGeneration()`
Получить последнюю генерацию
- **Возвращает:** Object|null - данные последней генерации или null

#### `saveLastGeneration(generationData)`
Сохранить последнюю генерацию
- **Параметры:** `generationData` (Object) - данные генерации
- **Возвращает:** boolean - успешность операции

### Управление сессией

#### `clearSession()`
Очистить сессию (удалить временные списки)
- **Возвращает:** number - количество удаленных списков

## Вспомогательные методы

### Создание списков

#### `createLocalList(name, heroes)`
Создать новый локальный список
- **Параметры:** 
  - `name` (string) - название списка
  - `heroes` (Array) - массив героев
- **Возвращает:** Object|null - созданный список или null

#### `createCloudList(name, heroes, cached)`
Создать новый облачный список
- **Параметры:** 
  - `name` (string) - название списка
  - `heroes` (Array) - массив героев
  - `cached` (boolean) - кэширован ли список
- **Возвращает:** Object|null - созданный список или null

#### `createTempList(name, heroes, baseListId)`
Создать временный список (исключения)
- **Параметры:** 
  - `name` (string) - название списка
  - `heroes` (Array) - массив героев
  - `baseListId` (string) - ID базового списка
- **Возвращает:** Object|null - созданный список или null

### Утилиты

#### `generateUUID()`
Генерация уникального UUID
- **Возвращает:** string - уникальный ID

#### `validateList(list)`
Валидация структуры списка
- **Параметры:** `list` (Object) - объект списка для валидации
- **Возвращает:** boolean - валидность структуры

#### `exportData()`
Экспорт всех данных
- **Возвращает:** Object - все данные приложения

#### `importData(data)`
Импорт данных
- **Параметры:** `data` (Object) - данные для импорта
- **Возвращает:** boolean - успешность операции

### Настройки и тема

#### `getSettings()`
Получить настройки
- **Возвращает:** Object - настройки приложения

#### `saveSettings(settings)`
Сохранить настройки
- **Параметры:** `settings` (Object) - настройки для сохранения
- **Возвращает:** boolean - успешность операции

#### `getTheme()`
Получить тему
- **Возвращает:** string - текущая тема

#### `setTheme(theme)`
Установить тему
- **Параметры:** `theme` (string) - название темы
- **Возвращает:** boolean - успешность операции

### Статистика

#### `getStats()`
Получить статистику использования
- **Возвращает:** Object - статистика использования

#### `clearAll()`
Очистить все данные
- **Возвращает:** boolean - успешность операции

## Использование

```javascript
// Получение глобального экземпляра
const storage = window.storageManager;

// Создание нового локального списка
const newList = storage.createLocalList('Мои герои', ['Герой1', 'Герой2', 'Герой3']);

// Установка активного списка
storage.setActiveList(newList.id);

// Сохранение генерации
storage.saveLastGeneration({
  players: [
    {number: 1, hero: 'Герой1', team: 1},
    {number: 2, hero: 'Герой2', team: 2}
  ]
});

// Получение всех локальных списков
const localLists = storage.getLists('local');

// Очистка сессии
const deletedCount = storage.clearSession();
```

## Типы списков

### Local (Локальные)
- Хранятся только в localStorage
- Создаются пользователем
- Содержат: `id`, `name`, `heroes`, `type`, `createdAt`

### Cloud (Облачные)
- Синхронизируются с облаком
- Могут быть кэшированы
- Содержат: `id`, `name`, `heroes`, `type`, `cached`, `lastSync`

### Temp (Временные)
- Создаются для исключений из основного списка
- Удаляются при очистке сессии
- Содержат: `id`, `name`, `heroes`, `type`, `baseListId`

## Валидация

Все списки проходят валидацию перед сохранением:
- Проверка обязательных полей
- Проверка типов данных
- Проверка корректности типа списка
- Проверка структуры героев

## Обработка ошибок

Модуль включает обработку ошибок для:
- Некорректных данных JSON
- Ошибок записи в localStorage
- Валидации данных
- Импорта/экспорта данных
